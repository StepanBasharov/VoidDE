local M = {}

function M.base64_encode()
    local lines = vim.api.nvim_buf_get_lines(0, 0, -1, false)
    local text = table.concat(lines, "\n")
    local encoded = vim.fn.system("echo -n '" .. text .. "' | base64")
    vim.api.nvim_buf_set_lines(0, 0, -1, false, vim.split(encoded, "\n"))
    vim.notify("Base64 Encoded!", vim.log.levels.INFO)
end

function M.base64_decode()
    local lines = vim.api.nvim_buf_get_lines(0, 0, -1, false)
    local text = table.concat(lines, "\n")
    local decoded = vim.fn.system("echo '" .. text .. "' | base64 -d")
    vim.api.nvim_buf_set_lines(0, 0, -1, false, vim.split(decoded, "\n"))
    vim.notify("Base64 Decoded!", vim.log.levels.INFO)
end

function M.hash_md5()
    local lines = vim.api.nvim_buf_get_lines(0, 0, -1, false)
    local text = table.concat(lines, "\n")
    local hash = vim.fn.system("echo -n '" .. text .. "' | md5sum | cut -d' ' -f1")
    vim.notify("MD5: " .. hash, vim.log.levels.INFO)
    vim.fn.setreg("+", hash)
end

function M.hash_sha256()
    local lines = vim.api.nvim_buf_get_lines(0, 0, -1, false)
    local text = table.concat(lines, "\n")
    local hash = vim.fn.system("echo -n '" .. text .. "' | sha256sum | cut -d' ' -f1")
    vim.notify("SHA256: " .. hash, vim.log.levels.INFO)
    vim.fn.setreg("+", hash)
end

function M.make_executable()
    local file = vim.fn.expand("%")
    vim.fn.system("chmod +x " .. file)
    vim.notify("Made " .. file .. " executable!", vim.log.levels.INFO)
end

function M.run_python_script()
    local file = vim.fn.expand("%")
    vim.cmd("vsplit | terminal python3 " .. file)
end

function M.run_bash_script()
    local file = vim.fn.expand("%")
    vim.cmd("vsplit | terminal bash " .. file)
end

function M.setup_keymaps()
    vim.keymap.set("n", "<leader>xe", M.make_executable, { desc = "Make executable" })
    vim.keymap.set("n", "<leader>xp", M.run_python_script, { desc = "Run Python" })
    vim.keymap.set("n", "<leader>xb", M.run_bash_script, { desc = "Run Bash" })
    vim.keymap.set("v", "<leader>be", M.base64_encode, { desc = "Base64 Encode" })
    vim.keymap.set("v", "<leader>bd", M.base64_decode, { desc = "Base64 Decode" })
    vim.keymap.set("n", "<leader>hm", M.hash_md5, { desc = "MD5 Hash" })
    vim.keymap.set("n", "<leader>hs", M.hash_sha256, { desc = "SHA256 Hash" })
end

return M

